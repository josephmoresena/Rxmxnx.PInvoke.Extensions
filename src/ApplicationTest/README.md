# Disclaimer

In these projects, `Rxmxnx.PInvoke.Extensions` is used via *intermediate libraries* rather than through its packaged
`NuGet` distributions.

However, when built through **GitHub Actions**, the projects use a `NuGet` package generated dynamically from the source
code of the branch being executed in the workflow.

# LauncherTest

`LauncherTest` is an application designed to automate the build—and optionally, the execution—of multiple test projects
for all .NET versions (and Mono Runtime) and deployment modes supported by `Rxmxnx.PInvoke.Extensions`, including
**R2R**, **NativeAOT**, **MonoAOT**, **Self-Contained** builds. It is intended to be compiled using **NativeAOT** to
maximize performance.

## Requirements

To run this application, the following prerequisites must be met:

- Operating system: **Linux**, **Windows**, **macOS** or **FreeBSD**
- Latest version of the **.NET SDK** installed
- Latest version of the **Mono MDK** installed. (Optional)

## Usage

The application accepts the following parameters:

1. **Project directory** – Path to the directory containing the test projects (e.g., `src/ApplicationTest`)
2. **Output directory** – Path where the build artifacts will be stored.
3. **Execution mode** – Determines the application's behavior:
    - `"run"` – Executes the artifacts found in the output directory
    - `"compile"` – Only compiles the projects without running them
    - *(none specified)* – Performs both compilation and execution

## Supported Platforms and Targets

All test projects are built for each .NET version supported by `Rxmxnx.PInvoke.Extensions`, targeting the available
platforms and modes for that version:

- **Windows**: x86, x86-64, arm64
- **Linux**: x86-64, arm, arm64
- **macOS**: x86-64, arm64
- **FreeBSD**: x86-64, arm64

> **Note**: The **reflection-free mode** is only available in .NET 9.0 and earlier. If a project is not compatible with
> this mode, its corresponding artifact will be skipped.

## Artifacts

The artifacts generated by GitHub Actions include **NativeAOT builds** of the test projects for each supported platform:

- **Windows**: x86, x86-64, arm64
- **Linux**: x86-64, arm, arm64
- **macOS**: x86-64, arm64
- **FreeBSD**: x86-64
- **NodeJS**: wasm (Experimental)

In addition to the binaries, a separate artifact is produced containing a set
of [NativeAOT build diagnostics](https://github.com/dotnet/runtime/blob/main/src/coreclr/nativeaot/docs/troubleshooting.md).  
These provide insight into the compilation process, indicating which components were trimmed or preserved.

---

# Application Test

This application is designed to showcase the capabilities and potential of using `Rxmxnx.PInvoke.Extensions` in modern
.NET or Mono/Xamarin applications.

These capabilities range from introspection of the runtime environment itself, native handling of UTF-8 strings,
interaction with native code, as well as optimization of memory usage by using `Span` over multimodal arrays or managed
dynamic buffers to store reference types on the stack.

The project uses C# 9.0 syntax to remain compatible with Mono 6.12, but it is compiled for all compatible versions of
.NET Core/.NET.

## Considerations

- Building with .NET Core/.NET enables a demonstration of JSON serialization/deserialization of UTF-8 strings while
  avoiding re-encoding.
- When builds targeting .NET 9.0 or later reference the VNext project, where some additional features are used.

# VNext Test

The VNext test library project allows demonstrating the functionality of mutable UTF-8 strings and advanced handling of
pointers to ref-struct values.

# WebApi Test

The ASP .NET Core project demonstrates how it is possible to integrate JSON serialization of UTF-8 strings (and
sequences) while avoiding re-encoding.
